#!/usr/bin/env sh

set -eu

# TODO: This function is a bit too magic, I should figure out a better method
get_current_volume() {
    pactl get-sink-volume @DEFAULT_SINK@ | head -n 1 | awk '{printf "%d",($5 + $12)/2}'
}

set_volume() {
    direction="$1"
    volume_increment="$2"
    current_volume="$(get_current_volume)"

    # Unmute if we're muted
    pactl set-sink-mute @DEFAULT_SINK@ 0

    if [ "$direction" = "-" ]; then
        pactl set-sink-volume @DEFAULT_SINK@ "-${volume_increment}%"
        return
    fi

    # Make sure the current volume is lower than 100%
    if [ "$current_volume" -lt 100 ]; then

        # If the volume increase would put us over 100%, just set the volume
        # to 100%
        if [ $((current_volume+volume_increment)) -gt 100 ]; then
            pactl set-sink-volume @DEFAULT_SINK@ "100%"
        else
            pactl set-sink-volume @DEFAULT_SINK@ "+${volume_increment}%"
        fi
    fi
}

case "$1" in
    mute)
        pactl set-sink-mute @DEFAULT_SINK@ 1
        ;;
    toggle-mute)
        pactl set-sink-mute @DEFAULT_SINK@ toggle
        ;;
    increase)
        set_volume "+" "${2:-2}"
        ;;
    decrease)
        set_volume "-" "${2:-2}"
        ;;
    *)
        echo "No arguments given, exiting..."
        ;;
esac

